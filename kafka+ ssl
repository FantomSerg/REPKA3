services:
  kafka-1:
    image: "${KAFKA_IMAGE_NAME}:${KAFKA_IMAGE_VERSION}"
    container_name: "kafka-1"
    restart: unless-stopped
    ports:
      - ${KAFKA_1_EXTERNAL_SSL_PORT}:${KAFKA_INTERNAL_SSL_PORT}
      - ${KAFKA_1_LISTEN_CLUSTER_PORT}:${KAFKA_LISTEN_INTERNAL_CLUSTER_PORT}
    environment:
      KAFKA_NODE_ID: ${KAFKA_1_NODE_ID}
      CLUSTER_ID: "${KAFKA_CLUSTER_ID}"
      KAFKA_PROCESS_ROLES: "broker,controller"
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: "SSL:SSL,CONTROLLER:PLAINTEXT,SSL-INTERNAL:SSL"
      KAFKA_CONTROLLER_QUORUM_VOTERS: "${KAFKA_1_NODE_ID}@${KAFKA_1_EXTERNAL_HOST}:${KAFKA_1_LISTEN_CLUSTER_PORT},${KAFKA_2_NODE_ID}@${KAFKA_2_EXTERNAL_HOST}:${KAFKA_2_LISTEN_CLUSTER_PORT},${KAFKA_3_NODE_ID}@${KAFKA_3_EXTERNAL_HOST}:${KAFKA_3_LISTEN_CLUSTER_PORT}"
      KAFKA_LISTENERS: "SSL-INTERNAL://:19093,CONTROLLER://kafka-1:${KAFKA_LISTEN_INTERNAL_CLUSTER_PORT},SSL://:${KAFKA_INTERNAL_SSL_PORT}"
      KAFKA_INTER_BROKER_LISTENER_NAME: "SSL-INTERNAL"
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "false"
      KAFKA_SECURITY_PROTOCOL: SSL
      KAFKA_ADVERTISED_LISTENERS: "SSL-INTERNAL://:19093,SSL://${KAFKA_1_EXTERNAL_HOST}:${KAFKA_1_EXTERNAL_SSL_PORT}"
      KAFKA_CONTROLLER_LISTENER_NAMES: "CONTROLLER"
      KAFKA_LOG_DIRS: "${KAFKA_INTERNAL_LOGS_STORE_PATH}"
      KAFKA_SSL_KEYSTORE_FILENAME: "kafka.jks"
      KAFKA_SSL_KEYSTORE_CREDENTIALS: "kafka_keystore_creds"
      KAFKA_SSL_KEY_CREDENTIALS: "kafka_keystore_creds"
      KAFKA_SSL_TRUSTSTORE_FILENAME: "kafka.jks"
      KAFKA_SSL_TRUSTSTORE_CREDENTIALS: "kafka_keystore_creds"
      KAFKA_SSL_CLIENT_AUTH: "required"
      KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: ""
    volumes:
      - "${KAFKA_SECRETS_EXTERNAL_STORE_PATH}:${KAFKA_SECRETS_INTERNAL_STORE_PATH}:ro"
      - "${KAFKA_EXTERNAL_STORE_PATH}/kafka-${KAFKA_1_NODE_ID}/log:${KAFKA_INTERNAL_LOGS_STORE_PATH}"
      - "${KAFKA_EXTERNAL_STORE_PATH}/kafka-${KAFKA_1_NODE_ID}/config:/mnt/shared/config"
