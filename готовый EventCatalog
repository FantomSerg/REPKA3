#11 [ 7/11] COPY create-eventcatalog.exp /app/create-eventcatalog.exp
#11 CACHED
#12 [ 8/11] RUN ls -l /app/
#12 0.346 total 4
#12 0.346 -rw-rw-r--. 1 root root 270 Mar 20 22:31 create-eventcatalog.exp
#12 DONE 0.4s
#13 [ 9/11] RUN chmod +x /app/create-eventcatalog.exp && /app/create-eventcatalog.exp
": no such file or directory

RUN apt-get update && \
    apt-get install -y --no-install-recommends git expect && \
    npm install -g npm@latest && \
    rm -rf /var/lib/apt/lists/*

FROM node:latest AS build

# Устанавливаем необходимые утилиты
RUN apt-get update && apt-get install -y --no-install-recommends git expect && \
    npm install -g npm@latest && \
    rm -rf /var/lib/apt/lists/*

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем expect-скрипт внутрь контейнера
COPY create-eventcatalog.exp /app/create-eventcatalog.exp

# Делаем скрипт исполняемым и запускаем его
RUN chmod +x /app/create-eventcatalog.exp && /app/create-eventcatalog.exp

# Переходим в созданную директорию
WORKDIR /app/my-event-catalog

# Устанавливаем плагины
RUN npm install @eventcatalog/generator-asyncapi @eventcatalog/generator-openapi

RUN sed -i '/strict-peer-dependencies/d' /app/my-event-catalog/.npmrc || true

# Открываем порт
EXPOSE 3000

# Запускаем приложение
CMD ["npm", "run", "dev"]


create-eventcatalog.exp 
#!/usr/bin/expect -f
set timeout -1
spawn npx @eventcatalog/create-eventcatalog@3.0.0
expect "Ok to proceed?"
send "y\r"
expect "What is your project named?"
send "my-event-catalog\r"
expect "What is your organization name?"
send "EventCatalog Ltd\r"
expect eof

